<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV Navigation Framework - Demo & Documentation</title>
    
    <!-- Bootstrap 5.3 -->
    <link href="https://bootswatch.com/5/pulse/bootstrap.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/cmrodican/bootstrap-addons/tv-navigation-framework/tv-navigation-framework.min.css" rel="stylesheet">
    <!-- TV Navigation Framework CSS -->
    <style>
/* TV Navigation Framework CSS - v1.0 */
/* Compatible with Bootstrap 5.3 and Bootswatch themes */

:root {
  --tv-nav-primary: #007bff;
  --tv-nav-secondary: #6c757d;
  --tv-nav-success: #28a745;
  --tv-nav-danger: #dc3545;
  --tv-nav-warning: #ffc107;
  --tv-nav-info: #17a2b8;
  --tv-nav-light: #f8f9fa;
  --tv-nav-dark: #343a40;
  
  --tv-nav-focus-color: var(--tv-nav-primary);
  --tv-nav-focus-glow: 0 0 0 3px rgba(0, 123, 255, 0.5);
  --tv-nav-focus-scale: 1.05;
  --tv-nav-border-radius: 8px;
  --tv-nav-transition: all 0.2s ease-in-out;
}

/* TV-friendly base styles */
* {
  box-sizing: border-box;
}

body.tv-nav-enabled {
  font-size: 1.2rem;
  line-height: 1.6;
  overflow-x: hidden;
}

/* Focusable elements */
.tv-nav-focusable {
  position: relative;
  border: 2px solid transparent;
  border-radius: var(--tv-nav-border-radius);
  transition: var(--tv-nav-transition);
  cursor: pointer;
  outline: none;
}

.tv-nav-focusable:focus,
.tv-nav-focused {
  border-color: var(--tv-nav-focus-color) !important;
  box-shadow: var(--tv-nav-focus-glow) !important;
  transform: scale(var(--tv-nav-focus-scale));
  z-index: 10;
  outline: none;
}

/* Button enhancements */
.btn.tv-nav-focusable {
  min-height: 48px;
  padding: 12px 24px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Card enhancements */
.card.tv-nav-focusable {
  transition: var(--tv-nav-transition);
}

.card.tv-nav-focusable:focus,
.card.tv-nav-focused {
  transform: scale(1.02);
}

/* Input enhancements */
.form-control.tv-nav-focusable,
.form-select.tv-nav-focusable {
  min-height: 48px;
  font-size: 1.1rem;
}

/* Navigation breadcrumbs */
.tv-nav-breadcrumb {
  position: fixed;
  top: 20px;
  left: 20px;
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 10px 20px;
  border-radius: var(--tv-nav-border-radius);
  font-size: 0.9rem;
  z-index: 1000;
  transition: var(--tv-nav-transition);
}

/* Status indicator */
.tv-nav-status {
  position: fixed;
  top: 20px;
  right: 20px;
  background: var(--tv-nav-success);
  color: white;
  padding: 8px 16px;
  border-radius: var(--tv-nav-border-radius);
  font-size: 0.8rem;
  z-index: 1000;
}

/* Loading overlay */
.tv-nav-loading {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: var(--tv-nav-transition);
}

.tv-nav-loading.active {
  opacity: 1;
  visibility: visible;
}

.tv-nav-spinner {
  width: 60px;
  height: 60px;
  border: 4px solid rgba(255, 255, 255, 0.3);
  border-top: 4px solid white;
  border-radius: 50%;
  animation: tv-nav-spin 1s linear infinite;
}

@keyframes tv-nav-spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* On-screen keyboard */
.tv-nav-keyboard {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: rgba(0, 0, 0, 0.95);
  padding: 20px;
  transform: translateY(100%);
  transition: transform 0.3s ease-in-out;
  z-index: 2000;
  border-top: 3px solid var(--tv-nav-primary);
}

.tv-nav-keyboard.active {
  transform: translateY(0);
}

.tv-nav-keyboard-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  color: white;
}

.tv-nav-keyboard-input {
  width: 100%;
  padding: 12px;
  font-size: 1.2rem;
  border: 2px solid var(--tv-nav-primary);
  border-radius: var(--tv-nav-border-radius);
  background: white;
  margin-bottom: 20px;
}

.tv-nav-keyboard-grid {
  display: grid;
  grid-template-columns: repeat(10, 1fr);
  gap: 8px;
  margin-bottom: 15px;
}

.tv-nav-keyboard-row {
  display: grid;
  grid-template-columns: repeat(10, 1fr);
  gap: 8px;
  margin-bottom: 8px;
}

.tv-nav-key {
  background: #444;
  color: white;
  border: 2px solid transparent;
  border-radius: var(--tv-nav-border-radius);
  padding: 12px 8px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--tv-nav-transition);
  min-height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.tv-nav-key:hover,
.tv-nav-key:focus,
.tv-nav-key.tv-nav-focused {
  background: var(--tv-nav-primary);
  border-color: white;
  transform: scale(1.1);
  outline: none;
}

.tv-nav-key.space {
  grid-column: span 4;
}

.tv-nav-key.backspace,
.tv-nav-key.enter {
  grid-column: span 2;
}

.tv-nav-key.shift,
.tv-nav-key.caps {
  grid-column: span 1;
}

/* Special key styling */
.tv-nav-key.special {
  background: #666;
  font-size: 0.9rem;
}

.tv-nav-key.special:hover,
.tv-nav-key.special:focus,
.tv-nav-key.special.tv-nav-focused {
  background: var(--tv-nav-secondary);
}

.tv-nav-key.active {
  background: var(--tv-nav-warning) !important;
  color: black !important;
}

/* Help overlay */
.tv-nav-help {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 3000;
  opacity: 0;
  visibility: hidden;
  transition: var(--tv-nav-transition);
}

.tv-nav-help.active {
  opacity: 1;
  visibility: visible;
}

.tv-nav-help-content {
  background: white;
  padding: 40px;
  border-radius: var(--tv-nav-border-radius);
  max-width: 600px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
}

.tv-nav-help-title {
  font-size: 1.5rem;
  font-weight: bold;
  margin-bottom: 20px;
  color: var(--tv-nav-primary);
}

.tv-nav-help-section {
  margin-bottom: 20px;
}

.tv-nav-help-section h4 {
  color: var(--tv-nav-secondary);
  margin-bottom: 10px;
}

.tv-nav-help-key {
  display: inline-block;
  background: var(--tv-nav-dark);
  color: white;
  padding: 4px 8px;
  border-radius: 4px;
  font-family: monospace;
  font-size: 0.9rem;
  margin-right: 5px;
}

/* Animations */
@keyframes tv-nav-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.tv-nav-pulse {
  animation: tv-nav-pulse 1s ease-in-out infinite;
}

@keyframes tv-nav-shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

.tv-nav-shake {
  animation: tv-nav-shake 0.5s ease-in-out;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .tv-nav-keyboard-grid {
    grid-template-columns: repeat(8, 1fr);
  }
  
  .tv-nav-key.space {
    grid-column: span 3;
  }
}

/* Theme compatibility */
.navbar .tv-nav-focusable:focus,
.navbar .tv-nav-focused {
  background-color: rgba(255, 255, 255, 0.1) !important;
}

.dropdown-menu .tv-nav-focusable:focus,
.dropdown-menu .tv-nav-focused {
  background-color: var(--tv-nav-primary) !important;
  color: white !important;
}

/* Accessibility improvements */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .tv-nav-focusable:focus,
  .tv-nav-focused {
    border-width: 4px;
    box-shadow: none;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Demo-specific styles */
.hero-section {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 80px 0;
}

.feature-card {
  transition: transform 0.3s ease;
  height: 100%;
}

.code-example {
  background: #f8f9fa;
  border-left: 4px solid #007bff;
  padding: 1rem;
  margin: 1rem 0;
}

.highlight {
  background: rgba(255, 193, 7, 0.3);
  padding: 2px 4px;
  border-radius: 3px;
}
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand tv-nav-focusable" href="#" data-tv-nav="home">
                <i class="bi bi-tv"></i> TV Navigation Framework
            </a>
            <button class="navbar-toggler tv-nav-focusable" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link tv-nav-focusable" href="#overview">Overview</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link tv-nav-focusable" href="#installation">Installation</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link tv-nav-focusable" href="#components">Components</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link tv-nav-focusable" href="#controls">Controls</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link tv-nav-focusable" href="#api">API</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="hero" class="bg-primary text-white p-5">
        <div class="container text-center">
            <h1 class="display-4 mb-4">TV Navigation Framework</h1>
            <p class="lead mb-5">Navigate web applications with TV remotes and game controllers. Perfect for Smart TVs, streaming devices, and console browsers.</p>
            <div class="d-flex justify-content-center gap-3 flex-wrap">
                <button class="btn btn-light btn-lg tv-nav-focusable" onclick="tvNav.showHelp()">
                    <i class="bi bi-question-circle"></i> View Controls
                </button>
                <button class="btn btn-light btn-lg tv-nav-focusable" onclick="showModal()">
                    <i class="bi bi-question-circle"></i> Demo Modal
                </button>
                <button class="btn btn-outline-light btn-lg tv-nav-focusable" onclick="tvNav.toggleKeyboard()">
                    <i class="bi bi-keyboard"></i> Try Keyboard
                </button>
                <button class="btn btn-warning btn-lg tv-nav-focusable" onclick="showModal()">
                    <i class="bi bi-play-circle"></i> Demo Modal
                </button>
            </div>
        </div>
    </section>

    <!-- Overview Section -->
    <section id="overview" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">Overview</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card feature-card tv-nav-focusable">
                        <div class="card-body text-center">
                            <i class="bi bi-joystick display-4 text-primary mb-3"></i>
                            <h5 class="card-title">Controller Support</h5>
                            <p class="card-text">Full support for game controllers and TV remotes with customizable button mapping.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card feature-card tv-nav-focusable">
                        <div class="card-body text-center">
                            <i class="bi bi-keyboard display-4 text-success mb-3"></i>
                            <h5 class="card-title">On-Screen Keyboard</h5>
                            <p class="card-text">Built-in virtual keyboard for text input using only directional controls.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card feature-card tv-nav-focusable">
                        <div class="card-body text-center">
                            <i class="bi bi-volume-up display-4 text-info mb-3"></i>
                            <h5 class="card-title">Audio Feedback</h5>
                            <p class="card-text">Customizable audio cues for navigation, selection, and error feedback.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Installation Section -->
    <section id="installation" class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center mb-5">Installation</h2>
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="code-example">
                        <h5>1. Include the CSS</h5>
                        <pre><code>&lt;link href="tv-navigation-framework.css" rel="stylesheet"&gt;</code></pre>
                    </div>
                    <div class="code-example">
                        <h5>2. Include the JavaScript</h5>
                        <pre><code>&lt;script src="tv-navigation-framework.js"&gt;&lt;/script&gt;</code></pre>
                    </div>
                    <div class="code-example">
                        <h5>3. Add Classes to Elements</h5>
                        <pre><code>&lt;button class="btn btn-primary <span class="highlight">tv-nav-focusable</span>"&gt;Click Me&lt;/button&gt;</code></pre>
                    </div>
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>That's it!</strong> The framework auto-initializes when the page loads. All elements with <code>tv-nav-focusable</code> class become navigable.
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Components Demo Section -->
    <section id="components" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">Interactive Components Demo</h2>
            
            <!-- Buttons -->
            <div class="row mb-5">
                <div class="col-12">
                    <h4 class="mb-3">Buttons</h4>
                    <div class="d-flex flex-wrap gap-2">
                        <button class="btn btn-primary tv-nav-focusable">Primary</button>
                        <button class="btn btn-secondary tv-nav-focusable">Secondary</button>
                        <button class="btn btn-success tv-nav-focusable">Success</button>
                        <button class="btn btn-danger tv-nav-focusable">Danger</button>
                        <button class="btn btn-warning tv-nav-focusable">Warning</button>
                        <button class="btn btn-info tv-nav-focusable">Info</button>
                        <button class="btn btn-outline-primary tv-nav-focusable">Outline</button>
                    </div>
                </div>
            </div>

            <!-- Form Controls -->
            <div class="row mb-5">
                <div class="col-md-6">
                    <h4 class="mb-3">Form Controls</h4>
                    <form>
                        <div class="mb-3">
                            <label class="form-label">Text Input</label>
                            <input type="text" class="form-control tv-nav-focusable" placeholder="Click to open keyboard">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control tv-nav-focusable" placeholder="example@domain.com">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Select Option</label>
                            <select class="form-select tv-nav-focusable">
                                <option>Option 1</option>
                                <option>Option 2</option>
                                <option>Option 3</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Textarea</label>
                            <textarea class="form-control tv-nav-focusable" rows="3" placeholder="Click to open keyboard"></textarea>
                        </div>
                    </form>
                </div>
                <div class="col-md-6">
                    <h4 class="mb-3">Checkboxes & Radio</h4>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input tv-nav-focusable" type="checkbox" id="check1">
                            <label class="form-check-label" for="check1">Option 1</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input tv-nav-focusable" type="checkbox" id="check2">
                            <label class="form-check-label" for="check2">Option 2</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input tv-nav-focusable" type="checkbox" id="check3">
                            <label class="form-check-label" for="check3">Option 3</label>
                        </div>
                    </div>
                    <div>
                        <div class="form-check">
                            <input class="form-check-input tv-nav-focusable" type="radio" name="radioGroup" id="radio1">
                            <label class="form-check-label" for="radio1">Radio 1</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input tv-nav-focusable" type="radio" name="radioGroup" id="radio2">
                            <label class="form-check-label" for="radio2">Radio 2</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cards Grid -->
            <div class="row mb-5">
                <div class="col-12">
                    <h4 class="mb-3">Navigable Cards</h4>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card tv-nav-focusable" onclick="alert('Card 1 selected!')">
                        <div class="card-body">
                            <h5 class="card-title">Card 1</h5>
                            <p class="card-text">This is a clickable card. Navigate here and press Enter to select.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card tv-nav-focusable" onclick="alert('Card 2 selected!')">
                        <div class="card-body">
                            <h5 class="card-title">Card 2</h5>
                            <p class="card-text">Cards automatically scale and highlight when focused.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card tv-nav-focusable" onclick="alert('Card 3 selected!')">
                        <div class="card-body">
                            <h5 class="card-title">Card 3</h5>
                            <p class="card-text">Perfect for media galleries and content selection.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="row">
                <div class="col-12 text-center">
                    <h4 class="mb-3">Demo Actions</h4>
                    <div class="d-flex justify-content-center gap-3 flex-wrap">
                        <button class="btn btn-success tv-nav-focusable" onclick="tvNav.showStatus('Success action!')">
                            <i class="bi bi-check-circle"></i> Success Action
                        </button>
                        <button class="btn btn-warning tv-nav-focusable" onclick="tvNav.showLoading(true); setTimeout(() => tvNav.showLoading(false), 2000)">
                            <i class="bi bi-hourglass-split"></i> Show Loading
                        </button>
                        <button class="btn btn-info tv-nav-focusable" onclick="tvNav.playSound('select')">
                            <i class="bi bi-music-note"></i> Play Sound
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Controls Section -->
    <section id="controls" class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center mb-5">Control Mapping</h2>
            <div class="row">
                <div class="col-lg-10 mx-auto">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Controller/Remote</th>
                                    <th>Keyboard</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>D-Pad / Left Stick</td>
                                    <td>Arrow Keys</td>
                                    <td>Navigate between elements</td>
                                </tr>
                                <tr>
                                    <td>A Button / OK</td>
                                    <td>Enter</td>
                                    <td>Select/Activate element</td>
                                </tr>
                                <tr>
                                    <td>B Button / Back</td>
                                    <td>Escape / Backspace</td>
                                    <td>Go back/Cancel</td>
                                </tr>
                                <tr>
                                    <td>X/Y Button / Home</td>
                                    <td>Home</td>
                                    <td>Navigate to home/first element</td>
                                </tr>
                                <tr>
                                    <td>Menu/Options Button</td>
                                    <td>F10</td>
                                    <td>Show on-screen keyboard</td>
                                </tr>
                                <tr>
                                    <td>L1/R1 Shoulder Buttons</td>
                                    <td>Page Up/Page Down</td>
                                    <td>Navigate between sections</td>
                                </tr>
                                <tr>
                                    <td>-</td>
                                    <td>F1</td>
                                    <td>Show help overlay</td>
                                </tr>
                                <tr>
                                    <td>-</td>
                                    <td>Alt + M</td>
                                    <td>Toggle audio feedback</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- API Section -->
    <section id="api" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">JavaScript API</h2>
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="code-example">
                        <h5>Initialize with Options</h5>
                        <pre><code>const tvNav = new TVNavigationFramework({
  enableAudio: true,
  enableKeyboard: true,
  enableGamepad: true,
  audioVolume: 0.3
});</code></pre>
                    </div>

                    <div class="code-example">
                        <h5>Focus Specific Element</h5>
                        <pre><code>// Focus element by selector
tvNav.focusElement('#my-button');

// Get current focused element
const current = tvNav.getCurrentFocus();</code></pre>
                    </div>

                    <div class="code-example">
                        <h5>Control On-Screen Keyboard</h5>
                        <pre><code>// Show keyboard
tvNav.showKeyboard();

// Show keyboard for specific input
tvNav.showKeyboard(document.querySelector('#my-input'));

// Hide keyboard
tvNav.hideKeyboard();</code></pre>
                    </div>

                    <div class="code-example">
                        <h5>Add/Remove Focusable Elements</h5>
                        <pre><code>// Make element focusable
tvNav.addFocusableElement(element);

// Remove from navigation
tvNav.removeFocusableElement(element);</code></pre>
                    </div>

                    <div class="code-example">
                        <h5>Status and Feedback</h5>
                        <pre><code>// Show status message
tvNav.showStatus('Custom message', 3000);

// Show/hide loading
tvNav.showLoading(true);
tvNav.showLoading(false);

// Play sounds
tvNav.playSound('navigation');
tvNav.playSound('select');
tvNav.playSound('error');</code></pre>
                    </div>

                    <div class="code-example">
                        <h5>Navigation Control</h5>
                        <pre><code>// Programmatic navigation
tvNav.navigate('up');
tvNav.navigate('down');
tvNav.navigate('left');
tvNav.navigate('right');

// Navigate to home
tvNav.goHome();

// Go back in history
tvNav.goBack();</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Demo Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="border: none">
                    <h5 class="modal-title">TV Navigation Controls</h5>
                    <button type="button" class="btn-close tv-nav-focusable" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                  <div class="tv-nav-help-content">
                    <div class="tv-nav-help-title">TV Navigation Controls</div>

                    <div class="tv-nav-help-section">
                      <h4>Basic Navigation</h4>
                      <p><span class="tv-nav-help-key">Arrow Keys</span> Navigate between elements</p>
                      <p><span class="tv-nav-help-key">Enter</span> or <span class="tv-nav-help-key">A Button</span> Select/Activate</p>
                      <p><span class="tv-nav-help-key">Escape</span> or <span class="tv-nav-help-key">B Button</span> Go Back</p>
                    </div>

                    <div class="tv-nav-help-section">
                      <h4>Controller Mapping</h4>
                      <p><span class="tv-nav-help-key">A Button</span> <span class="tv-nav-help-key">Enter</span> Confirm/Select</p>
                      <p><span class="tv-nav-help-key">B Button</span> <span class="tv-nav-help-key">Escape</span> Back/Cancel</p>
                      <p><span class="tv-nav-help-key">X/Y Button</span> <span class="tv-nav-help-key">Home</span> Home/Main Menu</p>
                      <p><span class="tv-nav-help-key">Menu Button</span> <span class="tv-nav-help-key">F10</span> Show Keyboard</p>
                      <p><span class="tv-nav-help-key">L1/R1</span> <span class="tv-nav-help-key">Page Up/Down</span> Navigate Sections</p>
                    </div>

                    <div class="tv-nav-help-section">
                      <h4>Special Features</h4>
                      <p><span class="tv-nav-help-key">F1</span> Show this help</p>
                      <p><span class="tv-nav-help-key">F10</span> Show on-screen keyboard</p>
                      <p><span class="tv-nav-help-key">Alt + M</span> Toggle audio feedback</p>
                    </div>

                    <button class="btn btn-primary mt-3 tv-nav-focusable" onclick="tvNav.hideHelp()">Close Help</button>
                  </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary tv-nav-focusable" data-bs-dismiss="modal">Close Help</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Demo Modal -->
    <div class="modal fade" id="demoModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Demo Modal</h5>
                    <button type="button" class="btn-close tv-nav-focusable" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>This modal demonstrates navigation within modal dialogs. All elements remain navigable!</p>
                    <div class="mb-3">
                        <label class="form-label">Modal Input</label>
                        <input type="text" class="form-control tv-nav-focusable" placeholder="Try the keyboard here">
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-primary tv-nav-focusable">Action</button>
                        <button class="btn btn-secondary tv-nav-focusable">Another Action</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary tv-nav-focusable" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary tv-nav-focusable">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light py-5">
        <div class="container text-center">
            <h5>TV Navigation Framework</h5>
            <p class="mb-0">Making web applications accessible for TV and controller navigation.</p>
            <div class="mt-3">
                <button class="btn btn-outline-light tv-nav-focusable me-2" onclick="tvNav.showHelp()">
                    <i class="bi bi-question-circle"></i> Help
                </button>
                <button class="btn btn-outline-light tv-nav-focusable" onclick="tvNav.toggleAudio()">
                    <i class="bi bi-volume-up"></i> Toggle Audio
                </button>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/cmrodican/bootstrap-addons/tv-navigation-framework/tv-navigation-framework.min.js"></script>

    <!-- TV Navigation Framework JavaScript -->
    <script>
/**
 * TV Navigation Framework JavaScript - v1.0
 * Compatible with Bootstrap 5.3 and Bootswatch themes
 * Supports game controllers and TV remotes
 */

class TVNavigationFramework {
  constructor(options = {}) {
    this.options = {
      enableAudio: true,
      enableVisualFeedback: true,
      enableKeyboard: true,
      enableGamepad: true,
      enableBreadcrumbs: true,
      enableHelp: true,
      focusableSelector: '.tv-nav-focusable, button, a, input, select, textarea, [tabindex]:not([tabindex="-1"])',
      skipSelector: '.tv-nav-skip',
      audioVolume: 0.3,
      navigationSound: 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ',
      selectSound: 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ',
      errorSound: 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmkcBieJ',
      ...options
    };

    this.currentFocus = null;
    this.focusableElements = [];
    this.navigationHistory = [];
    this.audioContext = null;
    this.sounds = {};
    this.keyboardVisible = false;
    this.keyboardInput = null;
    this.gamepadIndex = null;
    this.gamepadButtons = {};
    this.isShiftPressed = false;
    this.isCapsLockOn = false;

    this.init();
  }

  async init() {
    this.createUI();
    this.setupEventListeners();
    if (this.options.enableAudio) {
      await this.initAudio();
    }
    if (this.options.enableGamepad) {
      this.initGamepad();
    }
    this.updateFocusableElements();
    this.setInitialFocus();
    this.showStatus('TV Navigation Ready');
  }

  createUI() {
    document.body.classList.add('tv-nav-enabled');

    // Create breadcrumb
    if (this.options.enableBreadcrumbs) {
      const breadcrumb = document.createElement('div');
      breadcrumb.className = 'tv-nav-breadcrumb';
      breadcrumb.id = 'tv-nav-breadcrumb';
      breadcrumb.textContent = 'Home';
      document.body.appendChild(breadcrumb);
    }

    // Create status indicator
    const status = document.createElement('div');
    status.className = 'tv-nav-status';
    status.id = 'tv-nav-status';
    status.textContent = 'Initializing...';
    document.body.appendChild(status);

    // Create loading overlay
    const loading = document.createElement('div');
    loading.className = 'tv-nav-loading';
    loading.id = 'tv-nav-loading';
    loading.innerHTML = '<div class="tv-nav-spinner"></div>';
    document.body.appendChild(loading);

    // Create on-screen keyboard
    if (this.options.enableKeyboard) {
      this.createKeyboard();
    }

    // Create help overlay
    if (this.options.enableHelp) {
      this.createHelp();
    }
  }

  createKeyboard() {
    const keyboard = document.createElement('div');
    keyboard.className = 'tv-nav-keyboard';
    keyboard.id = 'tv-nav-keyboard';

    const qwertyLayout = [
      ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0'],
      ['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p'],
      ['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l'],
      ['shift', 'z', 'x', 'c', 'v', 'b', 'n', 'm', 'backspace'],
      ['caps', 'space', 'enter', 'close']
    ];

    keyboard.innerHTML = `
      <div class="tv-nav-keyboard-header">
        <h3>On-Screen Keyboard</h3>
        <button class="btn btn-danger btn-sm" onclick="tvNav.hideKeyboard()">Close</button>
      </div>
      <input type="text" class="tv-nav-keyboard-input" id="tv-nav-keyboard-input" placeholder="Type here...">
      <div class="tv-nav-keyboard-layout">
        ${qwertyLayout.map(row => `
          <div class="tv-nav-keyboard-row">
            ${row.map(key => {
              let className = 'tv-nav-key tv-nav-focusable';
              let content = key;
              let span = '';
              
              if (key === 'space') {
                className += ' space';
                content = 'Space';
                span = ' style="grid-column: span 4;"';
              } else if (key === 'backspace') {
                className += ' backspace special';
                content = '⌫ Backspace';
                span = ' style="grid-column: span 2;"';
              } else if (key === 'enter') {
                className += ' enter special';
                content = '⏎ Enter';
                span = ' style="grid-column: span 2;"';
              } else if (key === 'shift') {
                className += ' shift special';
                content = '⇧ Shift';
              } else if (key === 'caps') {
                className += ' caps special';
                content = '⇪ Caps';
              } else if (key === 'close') {
                className += ' close special';
                content = '✕ Close';
                span = ' style="grid-column: span 2;"';
              }
              
              return `<button class="${className}" data-key="${key}"${span}>${content}</button>`;
            }).join('')}
          </div>
        `).join('')}
      </div>
    `;

    document.body.appendChild(keyboard);

    // Add event listeners to keyboard keys
    keyboard.addEventListener('click', (e) => {
      if (e.target.classList.contains('tv-nav-key')) {
        this.handleKeyboardKey(e.target.dataset.key);
      }
    });
  }

  createHelp() {
    const help = document.createElement('div');
    help.className = 'tv-nav-help';
    help.id = 'tv-nav-help';

    help.innerHTML = `
      <div class="tv-nav-help-content">
        <div class="tv-nav-help-title">TV Navigation Controls</div>
        
        <div class="tv-nav-help-section">
          <h4>Basic Navigation</h4>
          <p><span class="tv-nav-help-key">Arrow Keys</span> Navigate between elements</p>
          <p><span class="tv-nav-help-key">Enter</span> or <span class="tv-nav-help-key">A Button</span> Select/Activate</p>
          <p><span class="tv-nav-help-key">Escape</span> or <span class="tv-nav-help-key">B Button</span> Go Back</p>
        </div>

        <div class="tv-nav-help-section">
          <h4>Controller Mapping</h4>
          <p><span class="tv-nav-help-key">A Button</span> <span class="tv-nav-help-key">Enter</span> Confirm/Select</p>
          <p><span class="tv-nav-help-key">B Button</span> <span class="tv-nav-help-key">Escape</span> Back/Cancel</p>
          <p><span class="tv-nav-help-key">X/Y Button</span> <span class="tv-nav-help-key">Home</span> Home/Main Menu</p>
          <p><span class="tv-nav-help-key">Menu Button</span> <span class="tv-nav-help-key">F10</span> Show Keyboard</p>
          <p><span class="tv-nav-help-key">L1/R1</span> <span class="tv-nav-help-key">Page Up/Down</span> Navigate Sections</p>
        </div>

        <div class="tv-nav-help-section">
          <h4>Special Features</h4>
          <p><span class="tv-nav-help-key">F1</span> Show this help</p>
          <p><span class="tv-nav-help-key">F10</span> Show on-screen keyboard</p>
          <p><span class="tv-nav-help-key">Alt + M</span> Toggle audio feedback</p>
        </div>

        <button class="btn btn-primary mt-3 tv-nav-focusable" onclick="tvNav.hideHelp()">Close Help</button>
      </div>
    `;

    document.body.appendChild(help);
  }

  async initAudio() {
    try {
      this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
      
      // Create audio buffers for different sounds
      await this.createAudioBuffer('navigation', 200, 0.1);
      await this.createAudioBuffer('select', 400, 0.2);
      await this.createAudioBuffer('error', 150, 0.3);
      await this.createAudioBuffer('success', 600, 0.2);
    } catch (error) {
      console.warn('Audio initialization failed:', error);
      this.options.enableAudio = false;
    }
  }

  async createAudioBuffer(name, frequency, duration) {
    const sampleRate = this.audioContext.sampleRate;
    const length = sampleRate * duration;
    const buffer = this.audioContext.createBuffer(1, length, sampleRate);
    const data = buffer.getChannelData(0);

    for (let i = 0; i < length; i++) {
      data[i] = Math.sin(2 * Math.PI * frequency * i / sampleRate) * 0.1;
      // Apply fade out
      if (i > length * 0.7) {
        data[i] *= (length - i) / (length * 0.3);
      }
    }

    this.sounds[name] = buffer;
  }

  playSound(soundName) {
    if (!this.options.enableAudio || !this.audioContext || !this.sounds[soundName]) return;

    const source = this.audioContext.createBufferSource();
    const gainNode = this.audioContext.createGain();
    
    source.buffer = this.sounds[soundName];
    gainNode.gain.value = this.options.audioVolume;
    
    source.connect(gainNode);
    gainNode.connect(this.audioContext.destination);
    source.start();
  }

  initGamepad() {
    this.gamepadButtons = {
      0: 'select',  // A button
      1: 'back',    // B button
      2: 'home',    // X button
      3: 'home',    // Y button
      4: 'pageup',  // L1
      5: 'pagedown', // R1
      9: 'menu'     // Menu/Options button
    };

    window.addEventListener('gamepadconnected', (e) => {
      this.gamepadIndex = e.gamepad.index;
      this.showStatus('Controller Connected');
      console.log('Gamepad connected:', e.gamepad.id);
    });

    window.addEventListener('gamepaddisconnected', (e) => {
      this.gamepadIndex = null;
      this.showStatus('Controller Disconnected');
      console.log('Gamepad disconnected');
    });

    // Start gamepad polling
    this.pollGamepad();
  }

  pollGamepad() {
    if (this.gamepadIndex !== null) {
      const gamepad = navigator.getGamepads()[this.gamepadIndex];
      if (gamepad) {
        // Check buttons
        for (let i = 0; i < gamepad.buttons.length; i++) {
          const button = gamepad.buttons[i];
          const wasPressed = this.gamepadButtons[`pressed_${i}`] || false;
          const isPressed = button.pressed;

          if (isPressed && !wasPressed) {
            this.handleGamepadButton(i);
          }

          this.gamepadButtons[`pressed_${i}`] = isPressed;
        }

        // Check D-pad/analog sticks for navigation
        const leftStickX = gamepad.axes[0];
        const leftStickY = gamepad.axes[1];
        const dpadX = gamepad.axes[6] || 0;
        const dpadY = gamepad.axes[7] || 0;

        const threshold = 0.5;
        const wasLeft = this.gamepadButtons.wasLeft || false;
        const wasRight = this.gamepadButtons.wasRight || false;
        const wasUp = this.gamepadButtons.wasUp || false;
        const wasDown = this.gamepadButtons.wasDown || false;

        const isLeft = leftStickX < -threshold || dpadX < -threshold;
        const isRight = leftStickX > threshold || dpadX > threshold;
        const isUp = leftStickY < -threshold || dpadY < -threshold;
        const isDown = leftStickY > threshold || dpadY > threshold;

        if (isLeft && !wasLeft) this.navigate('left');
        if (isRight && !wasRight) this.navigate('right');
        if (isUp && !wasUp) this.navigate('up');
        if (isDown && !wasDown) this.navigate('down');

        this.gamepadButtons.wasLeft = isLeft;
        this.gamepadButtons.wasRight = isRight;
        this.gamepadButtons.wasUp = isUp;
        this.gamepadButtons.wasDown = isDown;
      }
    }

    requestAnimationFrame(() => this.pollGamepad());
  }

  handleGamepadButton(buttonIndex) {
    const action = this.gamepadButtons[buttonIndex];
    
    switch (action) {
      case 'select':
        this.activateElement();
        break;
      case 'back':
        this.goBack();
        break;
      case 'home':
        this.goHome();
        break;
      case 'menu':
        this.toggleKeyboard();
        break;
      case 'pageup':
        this.navigateSection('up');
        break;
      case 'pagedown':
        this.navigateSection('down');
        break;
    }
  }

  setupEventListeners() {
    document.addEventListener('keydown', (e) => this.handleKeyDown(e));
    document.addEventListener('focus', (e) => this.handleFocus(e), true);
    window.addEventListener('resize', () => this.updateFocusableElements());
    
    // Prevent default focus outline and use our custom styling
    document.addEventListener('focusin', (e) => {
      if (e.target.classList.contains('tv-nav-focusable')) {
        e.target.classList.add('tv-nav-focused');
      }
    });

    document.addEventListener('focusout', (e) => {
      if (e.target.classList.contains('tv-nav-focusable')) {
        e.target.classList.remove('tv-nav-focused');
      }
    });
  }

  handleKeyDown(e) {
    // Don't interfere if keyboard is visible and an input is focused
    if (this.keyboardVisible && document.activeElement === this.keyboardInput) {
      return;
    }

    const key = e.key;
    let handled = true;

    switch (key) {
      case 'ArrowUp':
        e.preventDefault();
        this.navigate('up');
        break;
      case 'ArrowDown':
        e.preventDefault();
        this.navigate('down');
        break;
      case 'ArrowLeft':
        e.preventDefault();
        this.navigate('left');
        break;
      case 'ArrowRight':
        e.preventDefault();
        this.navigate('right');
        break;
      case 'Enter':
        e.preventDefault();
        this.activateElement();
        break;
      case 'Escape':
      case 'Backspace':
        e.preventDefault();
        this.goBack();
        break;
      case 'Home':
        e.preventDefault();
        this.goHome();
        break;
      case 'PageUp':
        e.preventDefault();
        this.navigateSection('up');
        break;
      case 'PageDown':
        e.preventDefault();
        this.navigateSection('down');
        break;
      case 'F1':
        e.preventDefault();
        this.showHelp();
        break;
      case 'F10':
        e.preventDefault();
        this.toggleKeyboard();
        break;
      default:
        handled = false;
    }

    // Handle keyboard shortcuts
    if (e.altKey) {
      switch (key) {
        case 'm':
        case 'M':
          e.preventDefault();
          this.toggleAudio();
          handled = true;
          break;
      }
    }

    if (handled) {
      e.stopPropagation();
    }
  }

  navigate(direction) {
    if (!this.currentFocus) {
      this.setInitialFocus();
      return;
    }

    const currentRect = this.currentFocus.getBoundingClientRect();
    let bestElement = null;
    let bestDistance = Infinity;

    this.focusableElements.forEach(element => {
      if (element === this.currentFocus || !this.isElementVisible(element)) return;

      const rect = element.getBoundingClientRect();
      let isValidDirection = false;
      let distance = 0;

      switch (direction) {
        case 'up':
          isValidDirection = rect.bottom <= currentRect.top + 10;
          distance = Math.abs(rect.left - currentRect.left) + (currentRect.top - rect.bottom);
          break;
        case 'down':
          isValidDirection = rect.top >= currentRect.bottom - 10;
          distance = Math.abs(rect.left - currentRect.left) + (rect.top - currentRect.bottom);
          break;
        case 'left':
          isValidDirection = rect.right <= currentRect.left + 10;
          distance = Math.abs(rect.top - currentRect.top) + (currentRect.left - rect.right);
          break;
        case 'right':
          isValidDirection = rect.left >= currentRect.right - 10;
          distance = Math.abs(rect.top - currentRect.top) + (rect.left - currentRect.right);
          break;
      }

      if (isValidDirection && distance < bestDistance) {
        bestDistance = distance;
        bestElement = element;
      }
    });

    if (bestElement) {
      this.setFocus(bestElement);
      this.playSound('navigation');
    } else {
      this.playSound('error');
      this.shakeElement(this.currentFocus);
    }
  }

  navigateSection(direction) {
    const sections = document.querySelectorAll('section, .card, .container, .row');
    if (sections.length === 0) return;

    const currentSection = this.currentFocus ? this.currentFocus.closest('section, .card, .container, .row') : null;
    const currentIndex = currentSection ? Array.from(sections).indexOf(currentSection) : -1;

    let targetIndex;
    if (direction === 'up') {
      targetIndex = currentIndex > 0 ? currentIndex - 1 : sections.length - 1;
    } else {
      targetIndex = currentIndex < sections.length - 1 ? currentIndex + 1 : 0;
    }

    const targetSection = sections[targetIndex];
    const firstFocusable = targetSection.querySelector(this.options.focusableSelector);
    
    if (firstFocusable && this.isElementVisible(firstFocusable)) {
      this.setFocus(firstFocusable);
      this.playSound('navigation');
      this.updateBreadcrumb(`Section ${targetIndex + 1}`);
    }
  }

  activateElement() {
    if (!this.currentFocus) return;

    this.playSound('select');
    
    if (this.currentFocus.tagName === 'A') {
      this.currentFocus.click();
    } else if (this.currentFocus.tagName === 'BUTTON') {
      this.currentFocus.click();
    } else if (this.currentFocus.tagName === 'INPUT') {
      if (this.currentFocus.type === 'checkbox' || this.currentFocus.type === 'radio') {
        this.currentFocus.click();
      } else {
        this.showKeyboard(this.currentFocus);
      }
    } else if (this.currentFocus.tagName === 'SELECT') {
      this.currentFocus.focus();
      // Trigger dropdown
      const event = new KeyboardEvent('keydown', { key: 'Enter' });
      this.currentFocus.dispatchEvent(event);
    } else if (this.currentFocus.tagName === 'TEXTAREA') {
      this.showKeyboard(this.currentFocus);
    } else {
      // Generic click for other focusable elements
      this.currentFocus.click();
    }
  }

  goBack() {
    if (this.keyboardVisible) {
      this.hideKeyboard();
      return;
    }

    if (this.navigationHistory.length > 0) {
      const previousElement = this.navigationHistory.pop();
      if (previousElement && this.isElementVisible(previousElement)) {
        this.setFocus(previousElement, false);
        this.playSound('navigation');
        return;
      }
    }

    // Try to find a back button or close button
    const backButton = document.querySelector('[data-tv-nav="back"], .btn-back, .close, .modal-close');
    if (backButton && this.isElementVisible(backButton)) {
      backButton.click();
      this.playSound('select');
    } else {
      this.playSound('error');
    }
  }

  goHome() {
    // Try to find a home button or navigate to first focusable element
    const homeButton = document.querySelector('[data-tv-nav="home"], .btn-home, .navbar-brand');
    if (homeButton && this.isElementVisible(homeButton)) {
      this.setFocus(homeButton);
      this.playSound('select');
    } else {
      this.setInitialFocus();
      this.playSound('navigation');
    }
    this.updateBreadcrumb('Home');
  }

  showKeyboard(targetInput = null) {
    if (!this.options.enableKeyboard) return;

    this.keyboardVisible = true;
    this.keyboardInput = targetInput;
    const keyboard = document.getElementById('tv-nav-keyboard');
    const input = document.getElementById('tv-nav-keyboard-input');
    
    keyboard.classList.add('active');
    
    if (targetInput && targetInput.value) {
      input.value = targetInput.value;
    }
    
    // Focus first key
    const firstKey = keyboard.querySelector('.tv-nav-key');
    if (firstKey) {
      this.setFocus(firstKey, false);
    }
    
    this.playSound('select');
  }

  hideKeyboard() {
    if (!this.keyboardVisible) return;

    const keyboard = document.getElementById('tv-nav-keyboard');
    const input = document.getElementById('tv-nav-keyboard-input');
    
    // Transfer value back to original input
    if (this.keyboardInput && input.value !== this.keyboardInput.value) {
      this.keyboardInput.value = input.value;
      // Trigger input event
      const event = new Event('input', { bubbles: true });
      this.keyboardInput.dispatchEvent(event);
    }
    
    keyboard.classList.remove('active');
    this.keyboardVisible = false;
    
    // Return focus to original input or first focusable element
    if (this.keyboardInput && this.isElementVisible(this.keyboardInput)) {
      this.setFocus(this.keyboardInput, false);
    } else {
      this.setInitialFocus();
    }
    
    this.keyboardInput = null;
    this.playSound('navigation');
  }

  toggleKeyboard() {
    if (this.keyboardVisible) {
      this.hideKeyboard();
    } else {
      this.showKeyboard();
    }
  }

  handleKeyboardKey(key) {
    const input = document.getElementById('tv-nav-keyboard-input');
    
    switch (key) {
      case 'space':
        input.value += ' ';
        break;
      case 'backspace':
        input.value = input.value.slice(0, -1);
        break;
      case 'enter':
        this.hideKeyboard();
        return;
      case 'close':
        this.hideKeyboard();
        return;
      case 'shift':
        this.isShiftPressed = !this.isShiftPressed;
        this.updateKeyboardKeys();
        break;
      case 'caps':
        this.isCapsLockOn = !this.isCapsLockOn;
        this.updateKeyboardKeys();
        break;
      default:
        let char = key;
        if (this.isShiftPressed || this.isCapsLockOn) {
          char = char.toUpperCase();
        }
        input.value += char;
        // Reset shift after use
        if (this.isShiftPressed) {
          this.isShiftPressed = false;
          this.updateKeyboardKeys();
        }
    }
    
    this.playSound('select');
  }

  updateKeyboardKeys() {
    const keys = document.querySelectorAll('.tv-nav-key[data-key]');
    keys.forEach(key => {
      const keyValue = key.dataset.key;
      if (keyValue.length === 1 && /[a-zA-Z]/.test(keyValue)) {
        if (this.isShiftPressed || this.isCapsLockOn) {
          key.textContent = keyValue.toUpperCase();
        } else {
          key.textContent = keyValue.toLowerCase();
        }
      }
    });

    // Update shift key appearance
    const shiftKey = document.querySelector('.tv-nav-key[data-key="shift"]');
    if (shiftKey) {
      if (this.isShiftPressed) {
        shiftKey.classList.add('active');
      } else {
        shiftKey.classList.remove('active');
      }
    }

    // Update caps key appearance
    const capsKey = document.querySelector('.tv-nav-key[data-key="caps"]');
    if (capsKey) {
      if (this.isCapsLockOn) {
        capsKey.classList.add('active');
      } else {
        capsKey.classList.remove('active');
      }
    }
  }

  showHelp() {
    const help = document.getElementById('tv-nav-help');
    if (help) {
      help.classList.add('active');
      const closeButton = help.querySelector('button');
      if (closeButton) {
        this.setFocus(closeButton, false);
      }
    }
  }

  hideHelp() {
    const help = document.getElementById('tv-nav-help');
    if (help) {
      help.classList.remove('active');
      this.setInitialFocus();
    }
  }

  toggleAudio() {
    this.options.enableAudio = !this.options.enableAudio;
    this.showStatus(`Audio ${this.options.enableAudio ? 'Enabled' : 'Disabled'}`);
    this.playSound('select');
  }

  updateFocusableElements() {
    this.focusableElements = Array.from(document.querySelectorAll(this.options.focusableSelector))
      .filter(el => !el.matches(this.options.skipSelector) && this.isElementVisible(el));
  }

  isElementVisible(element) {
    if (!element) return false;
    
    const rect = element.getBoundingClientRect();
    const computedStyle = window.getComputedStyle(element);
    
    return rect.width > 0 && 
           rect.height > 0 && 
           computedStyle.visibility !== 'hidden' && 
           computedStyle.display !== 'none' &&
           element.offsetParent !== null;
  }

  setFocus(element, addToHistory = true) {
    if (!element || !this.isElementVisible(element)) return;

    // Add current focus to history
    if (addToHistory && this.currentFocus && this.currentFocus !== element) {
      this.navigationHistory.push(this.currentFocus);
      // Limit history size
      if (this.navigationHistory.length > 10) {
        this.navigationHistory.shift();
      }
    }

    // Remove focus from current element
    if (this.currentFocus) {
      this.currentFocus.classList.remove('tv-nav-focused');
      this.currentFocus.blur();
    }

    this.currentFocus = element;
    element.classList.add('tv-nav-focused');
    element.focus();

    // Scroll into view if needed
    this.scrollIntoView(element);

    // Update breadcrumb
    this.updateBreadcrumb(this.getElementBreadcrumb(element));
  }

  setInitialFocus() {
    this.updateFocusableElements();
    
    // Try to focus the first focusable element
    if (this.focusableElements.length > 0) {
      this.setFocus(this.focusableElements[0], false);
    }
  }

  scrollIntoView(element) {
    const rect = element.getBoundingClientRect();
    const isInView = rect.top >= 0 && rect.bottom <= window.innerHeight;
    
    if (!isInView) {
      element.scrollIntoView({ 
        behavior: 'smooth', 
        block: 'center',
        inline: 'nearest'
      });
    }
  }

  handleFocus(e) {
    if (e.target.classList.contains('tv-nav-focusable')) {
      this.currentFocus = e.target;
      e.target.classList.add('tv-nav-focused');
    }
  }

  getElementBreadcrumb(element) {
    const section = element.closest('section');
    const card = element.closest('.card');
    const modal = element.closest('.modal');
    
    if (modal) {
      const title = modal.querySelector('.modal-title');
      return title ? title.textContent : 'Modal';
    }
    
    if (card) {
      const title = card.querySelector('.card-title, .card-header');
      return title ? title.textContent : 'Card';
    }
    
    if (section) {
      const heading = section.querySelector('h1, h2, h3, h4, h5, h6');
      return heading ? heading.textContent : 'Section';
    }
    
    return element.textContent?.trim().substring(0, 30) || element.tagName;
  }

  updateBreadcrumb(text) {
    if (!this.options.enableBreadcrumbs) return;
    
    const breadcrumb = document.getElementById('tv-nav-breadcrumb');
    if (breadcrumb) {
      breadcrumb.textContent = text;
    }
  }

  showStatus(message, duration = 3000) {
    const status = document.getElementById('tv-nav-status');
    if (status) {
      status.textContent = message;
      status.style.opacity = '1';
      
      setTimeout(() => {
        status.style.opacity = '0.7';
      }, duration);
    }
  }

  showLoading(show = true) {
    const loading = document.getElementById('tv-nav-loading');
    if (loading) {
      if (show) {
        loading.classList.add('active');
      } else {
        loading.classList.remove('active');
      }
    }
  }

  shakeElement(element) {
    if (!element) return;
    element.classList.add('tv-nav-shake');
    setTimeout(() => {
      element.classList.remove('tv-nav-shake');
    }, 500);
  }

  // Public API methods
  focusElement(selector) {
    const element = document.querySelector(selector);
    if (element) {
      this.setFocus(element);
      return true;
    }
    return false;
  }

  addFocusableElement(element) {
    if (element && !element.classList.contains('tv-nav-focusable')) {
      element.classList.add('tv-nav-focusable');
      this.updateFocusableElements();
    }
  }

  removeFocusableElement(element) {
    if (element) {
      element.classList.remove('tv-nav-focusable', 'tv-nav-focused');
      this.updateFocusableElements();
    }
  }

  getCurrentFocus() {
    return this.currentFocus;
  }

  getFocusableElements() {
    return this.focusableElements;
  }

  destroy() {
    // Remove event listeners and clean up
    document.removeEventListener('keydown', this.handleKeyDown);
    document.removeEventListener('focus', this.handleFocus, true);
    window.removeEventListener('resize', this.updateFocusableElements);
    
    // Remove UI elements
    const elementsToRemove = [
      'tv-nav-breadcrumb',
      'tv-nav-status',
      'tv-nav-loading',
      'tv-nav-keyboard',
      'tv-nav-help'
    ];
    
    elementsToRemove.forEach(id => {
      const element = document.getElementById(id);
      if (element) {
        element.remove();
      }
    });
    
    // Remove classes
    document.body.classList.remove('tv-nav-enabled');
    document.querySelectorAll('.tv-nav-focused').forEach(el => {
      el.classList.remove('tv-nav-focused');
    });
    
    // Close audio context
    if (this.audioContext) {
      this.audioContext.close();
    }
  }
}

// Auto-initialize
window.tvNav = new TVNavigationFramework();
    </script>

    <!-- Demo Functions -->
    <script>
        function showModal() {
            const modal = new bootstrap.Modal(document.getElementById('demoModal'));
            modal.show();
        }

        // Initialize smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Show initial welcome message
        setTimeout(() => {
            tvNav.showStatus('Use arrow keys or F1 for help!', 5000);
        }, 2000);
    </script>
</body>
</html>